<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mini Snake / Snake Hell</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #2c3e50; 
            color: #ecf0f1; 
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            position: relative; 
        }

        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: flex; 
            justify-content: center;
            align-items: center;
            z-index: 1000; 
            transition: opacity 0.5s ease-out; 
        }

        #splash-screen img {
            width: 80%; 
            max-width: 300px;
        }

        #game-board {
            border: 5px solid #27ae60;
            background-color: #34495e; 
            display: grid;
            touch-action: none;
            min-width: 200px; 
            min-height: 200px;
            max-width: 600px; 
            max-height: 600px;
            transition: border-color 0.3s ease-in-out; 
        }

        #game-board.snake-hell-border {
            border-color: #ff6b6b;
        }

        .snake {
            background-color: #f1c40f; 
            border-radius: 2px;
            transition: 
                grid-row-start 0.18s linear, 
                grid-column-start 0.18s linear;
        }
        
        .snake-head {
            position: relative;
            overflow: hidden; 
        }
        
        .snake-head .eyes {
            position: absolute;
            top: 0; 
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 125%; 
            line-height: 1;
            transition: transform 0.18s linear; 
        }

        .food {
            background-color: #e74c3c; 
            border-radius: 50%; 
        }

        #score-board {
            position: absolute; 
            top: 10px;          
            left: 10px; 
            right: auto;
            padding: 5px 10px;
            font-size: 1.5em;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.4); 
            border-radius: 5px;
            z-index: 50; 
            transition: color 0.3s; 
            color: #ecf0f1; 
        }
        #score-board.new-record {
            color: #f1c40f; 
        }

        #high-score-board { 
            position: absolute;
            top: 50px; 
            left: 10px; 
            right: auto;
            padding: 5px 10px;
            font-size: 1.2em;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            z-index: 50;
            color: #ecf0f1; 
        }
        #new-record-message { 
            position: absolute;
            top: 90px; 
            left: 10px; 
            right: auto;
            padding: 5px 10px;
            font-size: 1.2em;
            font-weight: bold;
            background-color: #f1c40f; 
            color: #2c3e50; 
            border-radius: 5px;
            z-index: 55;
            display: none; 
        }

        #message {
            margin-top: 20px;
            font-size: 1.2em;
            color: #3498db; 
            text-align: center;
        }
        
        .game-control-button {
            position: absolute;
            padding: 10px 15px;
            font-size: 1em;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            z-index: 50;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s;
        }

        #settings-button { 
            top: 10px;
            right: 10px; 
            left: auto;
            background-color: #9b59b6; 
            font-size: 1.5em; 
            line-height: 1;
            padding: 5px 10px;
        }

        #modifier-button { 
            bottom: 20px;
            left: 20px;
            background-color: #3498db; 
        }
        
        /* Bot√£o de Roupa (Hanger) - REINSERIDO */
        #hanger-button { 
            bottom: 20px; 
            right: 20px; 
            background-color: #f39c12; 
            font-size: 1.5em; 
            line-height: 1; 
            padding: 5px 10px;
        }
        
        .game-control-button:disabled {
            background-color: #7f8c8d; 
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        .modal {
            background-color: #34495e;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center; 
            position: relative; 
        }

        #volume-button-modal {
            background-color: #9b59b6; 
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.5em; 
            line-height: 1;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 201;
        }
        
        #credits-button-modal {
            position: absolute; 
            top: 10px;
            left: 10px;
            background-color: #f39c12; 
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 1em;
            cursor: pointer;
            z-index: 201;
        }

        /* Bot√£o de Licen√ßa no modal de configura√ß√µes (Branco) */
        #license-button-modal { 
            position: absolute; 
            top: 50px; 
            left: 10px;
            background-color: #ecf0f1; /* Branco */
            color: #2c3e50; /* Cor do fundo do body para contraste */
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 1em;
            cursor: pointer;
            z-index: 201;
        }
        
        #settings-overlay .modal h2 {
            margin-top: 5px; 
            margin-bottom: 20px;
        }
        
        #settings-overlay .modal #volume-button-modal {
             position: absolute;
             top: 10px;
             right: 10px;
        }

        #credits-overlay .modal p {
            text-align: center;
            line-height: 1.5;
            margin: 10px 0;
        }
        #credits-overlay .modal h3 {
            margin-top: 25px;
            color: #2ecc71;
            border-bottom: 2px solid #2ecc71;
            padding-bottom: 5px;
        }
        
        /* Estilo para o modal de Licen√ßa */
        #license-overlay .modal {
             max-height: 80vh; 
             overflow-y: auto;
             align-items: flex-start; 
             text-align: left;
        }

        #license-overlay .modal h2 {
            text-align: center;
            width: 100%;
            margin-bottom: 15px;
        }

        #license-overlay .modal p {
            font-size: 0.9em;
            margin-bottom: 15px;
            white-space: pre-wrap; 
            word-wrap: break-word;
            line-height: 1.4;
        }

        .control-block {
            margin-bottom: 25px; 
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1); 
            padding: 10px;
            border-radius: 5px;
        }

        .control-block.disabled {
            opacity: 0.5; 
            pointer-events: none; 
        }

        .control-group {
            display: flex;
            align-items: center;
            justify-content: space-around;
            width: 100%;
        }

        .control-group button {
            background-color: #e74c3c; 
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        /* Game Over Styles */
        #game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); 
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 200; 
            cursor: default;
        }
        
        #game-over-modal {
            background-color: #34495e; 
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5); 
            width: 80%;
            max-width: 300px; 
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center; 
            text-align: center;
            font-size: 1.5em;
        }
        
        #game-over-modal p {
            font-weight: bold;
            margin: 5px 0;
            text-shadow: none;
        }

        #game-over-modal #record-break-message {
            font-size: 1.1em;
            color: #f1c40f; 
            margin-bottom: 15px;
            display: none; 
        }
        
        #game-over-modal #final-score {
            font-size: 1.8em; 
            margin-top: 10px;
            margin-bottom: 20px; 
        }

        #restart-button {
            background-color: #2ecc71; 
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.2s;
        }
        
        /* CSS para o Hanger Overlay (Roupa) - REINSERIDO */
        #hanger-overlay { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
    </style>
</head>
<body>
    
    <div id="splash-screen">
        <img src="MiniMiniGames.png" alt="Mini Games Splash Screen">
    </div>

    <button id="settings-button" class="game-control-button" aria-label="Abrir Configura√ß√µes">‚öôÔ∏è</button>

    <div id="score-board">
        <span id="score-icon">üî¥</span><span id="score-value">0</span>
    </div>
    
    <div id="high-score-board">
        Recorde: <span id="high-score-value">0</span>
    </div>
    <div id="new-record-message">
        Novo Recorde!
    </div>


    <h1 id="game-title">Mini Snake</h1> 
    <div id="game-board"></div>
    <div id="message">Arraste a tela para come√ßar!</div>

    <button id="modifier-button" class="game-control-button">Modificadores</button>
    <button id="hanger-button" class="game-control-button">üëï</button> <audio id="food-sound" preload="auto">
        <source src="Comida.m4a" type="audio/mp4">
        <source src="Comida.mp3" type="audio/mpeg">
    </audio>

    <audio id="slide-sound" preload="auto">
        <source src="Slide.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="click-sound" preload="auto">
        <source src="Click_1.mp3" type="audio/mpeg">
    </audio>


    <div id="settings-overlay" class="overlay">
        <div class="modal">
            <button id="credits-button-modal">Cr√©ditos</button>
            <button id="license-button-modal">LICEN√áA</button> <button id="volume-button-modal" aria-label="Ativar/Desativar Som">üîá</button>
            
            <h2>‚öôÔ∏è Configura√ß√µes</h2> 
            
            <button id="close-settings-modal" style="background-color: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;">
                Fechar
            </button>
        </div>
    </div>
    
    <div id="credits-overlay" class="overlay">
        <div class="modal">
            <h2>‚ú® Cr√©ditos</h2> 
            
            <p><strong>Mini Snake</strong></p>
            <p>Criado por <strong>P3DR0CA</strong></p>

            <h3>Agradecimentos:</h3>
            <p><strong>Gemini (Google)</strong><br>Ajudou a criar o jogo.</p>
            <p><strong>Kodular</strong><br>Ajudou a transformar site em app.</p>
            <p><strong>Git Hub</strong><br>Ajudou em site para transformar em app.</p>
            
            <button id="close-credits-modal" style="background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;">
                Voltar
            </button>
        </div>
    </div>
    
    <div id="license-overlay" class="overlay">
        <div class="modal">
            <h2>Mini Snake ‚Äì Proprietary License</h2> 
            
            <p id="license-text-content"></p>

            <button id="close-license-modal" style="background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;">
                Voltar
            </button>
        </div>
    </div>
    <div id="hanger-overlay" class="overlay"> 
        <div class="modal">
            <h2>üëï Trocar Cor e Apar√™ncia</h2> 
            
            <div class="control-block">
                <h3>Cor Atual</h3>
                <div id="color-controls" style="display: flex; align-items: center; justify-content: center;">
                    <button id="prev-color-button">&lt;</button>
                    <span id="current-color-display" style="font-size: 2.5em; margin: 0 15px;">üü®</span>
                    <button id="next-color-button">&gt;</button>
                </div>
            </div>

            <div class="control-block"> 
                <h3>Olhos</h3>
                <div id="eye-controls" style="display: flex; align-items: center; justify-content: center;">
                    <button id="prev-eye-button">&lt;</button>
                    <span id="current-eye-display" style="font-size: 2.5em; margin: 0 15px;"></span>
                    <button id="next-eye-button">&gt;</button>
                </div>
            </div>

            <button id="close-hanger-modal" style="background-color: #2ecc71; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;">
                Fechar
            </button>
        </div>
    </div>
    <div id="modifier-overlay" class="overlay">
        <div class="modal">
            <h2>‚ú® Modificadores</h2> 
            
            <div class="control-block">
                <h3>Modo de Jogo</h3>
                <div id="mode-controls" class="control-group">
                    <button id="prev-mode-button">&lt;</button>
                    <span id="current-mode-display">Mini Snake (Padr√£o)</span>
                    <button id="next-mode-button">&gt;</button>
                </div>
            </div>

            <div id="size-block" class="control-block">
                <h3>Tamanho do Mapa</h3>
                <div id="size-controls" class="control-group">
                    <button id="prev-size-button">&lt;</button>
                    <span id="current-size-display">20x20 (Padr√£o)</span>
                    <button id="next-size-button">&gt;</button>
                </div>
            </div>

            <div id="speed-block" class="control-block">
                <h3>Velocidade Base</h3>
                <div id="speed-controls" class="control-group">
                    <button id="prev-speed-button">&lt;</button> 
                    <span id="current-speed-display">1x (Padr√£o)</span>
                    <button id="next-speed-button">&gt;</button>
                </div>
            </div>

            <button id="close-modifier-modal" style="background-color: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px;">
                Fechar
            </button>
        </div>
    </div>


    <div id="game-over-overlay">
        <div id="game-over-modal">
            <p id="record-break-message">NOVO RECORDE!</p> 
            <p>GAME OVER!</p>
            <p id="final-score"></p>
            <button id="restart-button">Ir Denovo</button>
        </div>
    </div>
    <script>
        const SPLASH_SCREEN = document.getElementById('splash-screen'); 
        const GAME_BOARD = document.getElementById('game-board');
        const SCORE_BOARD_ELEMENT = document.getElementById('score-board'); 
        const SCORE_VALUE_ELEMENT = document.getElementById('score-value');
        const MESSAGE_BOX = document.getElementById('message');
        const GAME_OVER_OVERLAY = document.getElementById('game-over-overlay'); 
        const GAME_OVER_MODAL = document.getElementById('game-over-modal'); 
        const FINAL_SCORE_ELEMENT = document.getElementById('final-score'); 
        
        const MODIFIER_BUTTON = document.getElementById('modifier-button'); 
        const SETTINGS_BUTTON = document.getElementById('settings-button'); 
        const HANGER_BUTTON = document.getElementById('hanger-button'); // REINSERIDO
        const RESTART_BUTTON = document.getElementById('restart-button'); // REINSERIDO
        
        const SETTINGS_OVERLAY = document.getElementById('settings-overlay');
        const MODIFIER_OVERLAY = document.getElementById('modifier-overlay'); 
        const HANGER_OVERLAY = document.getElementById('hanger-overlay'); // REINSERIDO
        const CREDITS_OVERLAY = document.getElementById('credits-overlay'); 
        const LICENSE_OVERLAY = document.getElementById('license-overlay'); 
        
        const CLOSE_SETTINGS_MODAL = document.getElementById('close-settings-modal'); 
        const CLOSE_MODIFIER_MODAL = document.getElementById('close-modifier-modal'); 
        const CLOSE_HANGER_MODAL = document.getElementById('close-hanger-modal'); // REINSERIDO
        const CLOSE_CREDITS_MODAL = document.getElementById('close-credits-modal'); 
        const LICENSE_BUTTON_MODAL = document.getElementById('license-button-modal');
        const CLOSE_LICENSE_MODAL = document.getElementById('close-license-modal'); 
        const LICENSE_TEXT_ELEMENT = document.getElementById('license-text-content');
        
        const VOLUME_BUTTON_MODAL = document.getElementById('volume-button-modal'); 
        const CREDITS_BUTTON_MODAL = document.getElementById('credits-button-modal'); 

        const FOOD_SOUND = document.getElementById('food-sound'); 
        const SLIDE_SOUND = document.getElementById('slide-sound'); 
        const CLICK_SOUND = document.getElementById('click-sound'); 
        
        const SPEED_BLOCK = document.getElementById('speed-block'); 
        const CURRENT_SPEED_DISPLAY = document.getElementById('current-speed-display'); 
        const PREV_SPEED_BUTTON = document.getElementById('prev-speed-button');   
        const NEXT_SPEED_BUTTON = document.getElementById('next-speed-button');   
        
        const CURRENT_COLOR_DISPLAY = document.getElementById('current-color-display'); 
        const PREV_COLOR_BUTTON = document.getElementById('prev-color-button');   
        const NEXT_COLOR_BUTTON = document.getElementById('next-color-button'); 
        
        // CONSTANTES PARA OLHOS - REINSERIDO
        const CURRENT_EYE_DISPLAY = document.getElementById('current-eye-display'); 
        const PREV_EYE_BUTTON = document.getElementById('prev-eye-button');      
        const NEXT_EYE_BUTTON = document.getElementById('next-eye-button');      
        // FIM CONSTANTES

        const CURRENT_SIZE_DISPLAY = document.getElementById('current-size-display');
        const PREV_SIZE_BUTTON = document.getElementById('prev-size-button');
        const NEXT_SIZE_BUTTON = document.getElementById('next-size-button');

        const CURRENT_MODE_DISPLAY = document.getElementById('current-mode-display');
        const PREV_MODE_BUTTON = document.getElementById('prev-mode-button');
        const NEXT_MODE_BUTTON = document.getElementById('next-mode-button');

        const HIGH_SCORE_VALUE_ELEMENT = document.getElementById('high-score-value'); 
        const NEW_RECORD_MESSAGE_ELEMENT = document.getElementById('new-record-message'); 
        const RECORD_BREAK_MESSAGE_GAME_OVER = document.getElementById('record-break-message'); 
        
        const GAME_TITLE_ELEMENT = document.getElementById('game-title'); 

        const LICENSE_TEXT_CONTENT = `Mini Snake ‚Äì Proprietary License (All Rights Reserved)

Copyright ¬© MiniMinigames. All rights reserved.

This software, known as ‚ÄúMini Snake‚Äù, including all source code, compiled code, images, graphics, audio files, text, interfaces, and any other related files or materials, is the exclusive property of MiniMinigames.

No part of this software may be copied, reproduced, modified, distributed, sublicensed, sold, rented, reverse-engineered, decompiled, or used for any commercial or public purpose without prior written permission from MiniMinigames.

Permission is granted to the end user solely to install, run, and use the software for personal and non-commercial purposes.

MiniMinigames may, at its sole discretion, grant special permissions or additional rights to specific individuals or entities, provided such permissions are given in writing.

All rights not expressly granted are reserved by MiniMinigames.


---

DISCLAIMER OF WARRANTY

THE SOFTWARE IS PROVIDED ‚ÄúAS IS‚Äù, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND NON-INFRINGEMENT.

IN NO EVENT SHALL MINIMINIGAMES BE LIABLE FOR ANY CLAIMS, DAMAGES, LOSSES, OR OTHER LIABILITIES, WHETHER IN CONTRACT, TORT, OR OTHERWISE, ARISING FROM THE USE OF, OR INABILITY TO USE, THE SOFTWARE.`;

        const BASE_INTERVAL_MS = 180; 
        const SPEED_MULTIPLIERS = [0.5, 1, 1.5, 2, 2.5, 3]; 
        const GRID_SIZES = [10, 20, 30, 40, 50]; 
        const GAME_MODES = [
            { name: "Mini Snake", index: 0 },
            { name: "Snake Hell", index: 1 }
        ];
        
        const HIGH_SCORE_KEY_MINI = 'miniSnakeHighScore';
        const HIGH_SCORE_KEY_HELL = 'snakeHellHighScore';

        let gameLoopInterval = null; 
        let currentIntervalMS = BASE_INTERVAL_MS; 
        let activeMultiplierIndex = 1; 
        let activeSizeIndex = 1; 
        let activeModeIndex = 0; 
        let gridSize = GRID_SIZES[activeSizeIndex]; 
        let score = 0; 
        let highScore = 0; 
        let isNewRecord = false; 
        let isGameOver = false;
        
        let isMuted = true; 
        let audioHasBeenActivated = false; 

        const SNAKE_COLORS = [
            { emoji: 'üü®', css: '#f1c40f' }, 
            { emoji: 'üü•', css: '#e74c3c' },
            { emoji: 'üüß', css: '#e67e22' },
            { emoji: 'üü©', css: '#2ecc71' },
            { emoji: 'üü¶', css: '#3498db' },
            { emoji: 'üü™', css: '#9b59b6' },
            { emoji: 'üü´', css: '#795548' },
            { emoji: '‚¨õ', css: '#2c3e50' },
            { emoji: '‚¨ú', css: '#ecf0f1' }
        ];
        let activeColorIndex = 0; 
        
        // ARRAY DE OLHOS - REINSERIDO
        const SNAKE_EYES = [
            { emoji: '', name: 'Sem Rosto' }, 
            { emoji: 'üëÄ', name: 'Observador' }
        ];
        let activeEyeIndex = 0; 

        let snake = []; 
        let food = {}; 
        let direction = { x: 0, y: 0 }; 
        let newDirection = { x: 0, y: 0 }; 
        let lastValidDirection = { x: 0, y: -1 }; // Resetar para Cima

        let touchStartX = 0;
        let touchStartY = 0;
        const SWIPE_THRESHOLD = 30; 
        
        function playFoodSound() {
            if (FOOD_SOUND && audioHasBeenActivated && !isMuted) {
                FOOD_SOUND.currentTime = 0; 
                FOOD_SOUND.play().catch(error => {});
            }
        }
        
        function playSlideSound() {
            if (SLIDE_SOUND && audioHasBeenActivated && !isMuted) {
                SLIDE_SOUND.currentTime = 0; 
                SLIDE_SOUND.play().catch(error => {});
            }
        }
        
        function playClickSound() {
            if (CLICK_SOUND && audioHasBeenActivated && !isMuted) {
                CLICK_SOUND.currentTime = 0;
                CLICK_SOUND.play().catch(error => {});
            }
        }
        
        function toggleVolume() {
            isMuted = !isMuted;
            VOLUME_BUTTON_MODAL.textContent = isMuted ? 'üîá' : 'üîà'; 

            if (!isMuted) {
                if (!audioHasBeenActivated && FOOD_SOUND && SLIDE_SOUND && CLICK_SOUND) { 
                    FOOD_SOUND.muted = false; 
                    SLIDE_SOUND.muted = false; 
                    CLICK_SOUND.muted = false; 
                    FOOD_SOUND.play()
                        .then(() => {
                            FOOD_SOUND.pause();
                            FOOD_SOUND.currentTime = 0;
                            SLIDE_SOUND.pause();
                            CLICK_SOUND.pause(); 
                            audioHasBeenActivated = true;
                        })
                        .catch(error => {
                            console.error(`Falha ao liberar √°udio. Erro: ${error.name}.`);
                            isMuted = true; 
                            VOLUME_BUTTON_MODAL.textContent = 'üîá'; 
                        });
                }
            } else {
                FOOD_SOUND.pause();
                SLIDE_SOUND.pause();
                CLICK_SOUND.pause(); 
            }
        }

        function getActiveHighScoreKey() {
            return GAME_MODES[activeModeIndex].name === "Snake Hell" 
                ? HIGH_SCORE_KEY_HELL 
                : HIGH_SCORE_KEY_MINI;
        }

        function loadHighScore() {
            const key = getActiveHighScoreKey();
            const savedScore = localStorage.getItem(key);
            highScore = savedScore ? parseInt(savedScore) : 0;
            HIGH_SCORE_VALUE_ELEMENT.textContent = highScore;
        }

        function saveHighScore(newScore) {
            const key = getActiveHighScoreKey();
            localStorage.setItem(key, newScore.toString());
            highScore = newScore;
            HIGH_SCORE_VALUE_ELEMENT.textContent = highScore;
        }

        function checkRecord() {
            if (score > highScore) {
                isNewRecord = true;
                SCORE_BOARD_ELEMENT.classList.add('new-record');
                NEW_RECORD_MESSAGE_ELEMENT.style.display = 'block';
            } else {
                isNewRecord = false;
                SCORE_BOARD_ELEMENT.classList.remove('new-record');
                NEW_RECORD_MESSAGE_ELEMENT.style.display = 'none';
            }
        }
        
        function getRandomGridPosition() { 
            const min = 2;
            const max = gridSize - 1;
            
            if (gridSize < 3) return { x: 1, y: 1 }; 
            
            return { 
                x: Math.floor(Math.random() * (max - min + 1)) + min, 
                y: Math.floor(Math.random() * (max - min + 1)) + min
            }; 
        }

        function placeFood() { 
            let newFoodPosition; 
            do { 
                newFoodPosition = getRandomGridPosition(); 
            } while (snake.some(segment => segment.x === newFoodPosition.x && segment.y === newFoodPosition.y)); 
            food = newFoodPosition; 
        }

        function checkCollisions(head) { 
            if (head.x < 1 || head.x > gridSize || head.y < 1 || head.y > gridSize) { 
                gameOver(); 
                return; 
            } 
            for (let i = 4; i < snake.length; i++) { 
                if (head.x === snake[i].x && head.y === snake[i].y) { 
                    gameOver(); 
                    return; 
                } 
            } 
        }
        
        function handleTouchStart(e) { e.preventDefault(); touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; }
        function handleTouchMove(e) { e.preventDefault(); }
        
        function handleTouchEnd(e) { 
            e.preventDefault(); 
            if (isGameOver) { return; } 
            
            if (!gameLoopInterval) { 
                startGameLoop(); 
            } 
            
            const touchEndX = e.changedTouches[0].clientX; 
            const touchEndY = e.changedTouches[0].clientY; 
            const diffX = touchEndX - touchStartX; 
            const diffY = touchEndY - touchStartY; 
            let nextX = direction.x; 
            let nextY = direction.y; 
            
            if (Math.abs(diffX) > Math.abs(diffY)) { 
                if (Math.abs(diffX) > SWIPE_THRESHOLD) { 
                    if (diffX > 0) { if (direction.x !== -1) { nextX = 1; nextY = 0; } } else { if (direction.x !== 1) { nextX = -1; nextY = 0; } } 
                } 
            } else { 
                if (Math.abs(diffY) > SWIPE_THRESHOLD) { 
                    if (diffY > 0) { if (direction.y !== -1) { nextX = 0; nextY = 1; } } else { if (direction.y !== 1) { nextX = 0; nextY = -1; } } 
                } 
            } 
            
            if (nextX !== direction.x || nextY !== direction.y) {
                 playSlideSound(); 
            }

            newDirection = { x: nextX, y: nextY }; 
        }
        
        function drawGame() {
            GAME_BOARD.innerHTML = '';

            const snakeColor = SNAKE_COLORS[activeColorIndex].css; 
            const snakeEye = SNAKE_EYES[activeEyeIndex].emoji; // REINSERIDO

            snake.forEach((segment, index) => { 
                const snakeElement = document.createElement('div');
                snakeElement.style.gridRowStart = segment.y;
                snakeElement.style.gridColumnStart = segment.x;
                snakeElement.classList.add('snake');
                snakeElement.style.backgroundColor = snakeColor; 
                
                if (index === 0) { // Segmento da Cabe√ßa
                    snakeElement.classList.add('snake-head'); 
                    
                    if (snakeEye !== '') { 
                        const currentDir = direction.x === 0 && direction.y === 0 ? lastValidDirection : direction;
                        
                        // L√ìGICA DE INVERS√ÉO/FLIP (Horizontal para Direita OU Baixo)
                        let transform = ''; 
                        
                        if (currentDir.x === 1 || currentDir.y === 1) { // Direita (x=1) OU Baixo (y=1)
                            transform = 'scaleX(-1)'; 
                        } 
                        
                        const eyeElement = document.createElement('span');
                        eyeElement.classList.add('eyes');
                        eyeElement.textContent = snakeEye;
                        eyeElement.style.transform = transform;
                        snakeElement.appendChild(eyeElement);
                    }
                }
                
                GAME_BOARD.appendChild(snakeElement);
            });

            const foodElement = document.createElement('div');
            foodElement.style.gridRowStart = food.y;
            foodElement.style.gridColumnStart = food.x;
            foodElement.classList.add('food');
            GAME_BOARD.appendChild(foodElement);

            SCORE_VALUE_ELEMENT.textContent = score;
            checkRecord(); 
        }

        function updateGame() {
            if (isGameOver) return;

            direction = newDirection;
            if (direction.x !== 0 || direction.y !== 0) { 
                lastValidDirection = { x: direction.x, y: direction.y }; 
            }
            if (direction.x === 0 && direction.y === 0) { return; }

            const newHead = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
            snake.unshift(newHead);

            if (newHead.x === food.x && newHead.y === food.y) {
                playFoodSound(); 
                
                score += 1; 
                placeFood(); 
                
                if (GAME_MODES[activeModeIndex].name === "Mini Snake") {
                    if (SPEED_MULTIPLIERS[activeMultiplierIndex] === 1) { 
                        increaseSpeedMiniSnake();
                    }
                } else { 
                    snake.pop(); 
                    increaseSpeedSnakeHell();
                }

            } else {
                snake.pop(); 
            }

            checkCollisions(newHead);
            drawGame();
        }

        function increaseSpeedMiniSnake() {
            if (score > 0 && score % 5 === 0) {
                if (currentIntervalMS > 50) { 
                    currentIntervalMS -= 10; 
                    clearInterval(gameLoopInterval);
                    startGameLoop(); 
                }
            }
        }
        
        function increaseSpeedSnakeHell() {
            if (currentIntervalMS > 40) { 
                currentIntervalMS -= 3; 
                clearInterval(gameLoopInterval);
                startGameLoop(); 
            }
        }

        function startGameLoop() {
            gameLoopInterval = setInterval(updateGame, currentIntervalMS);
            MESSAGE_BOX.textContent = `Jogo em andamento!`; 
            updateModifierButtonState(); 
        }

        function gameOver() { 
            isGameOver = true; 
            clearInterval(gameLoopInterval); 
            gameLoopInterval = null; 
            MESSAGE_BOX.textContent = ""; 

            if (isNewRecord) {
                saveHighScore(score);
                RECORD_BREAK_MESSAGE_GAME_OVER.style.display = 'block';
                NEW_RECORD_MESSAGE_ELEMENT.style.display = 'none'; 
            }

            FINAL_SCORE_ELEMENT.innerHTML = `<span id="score-icon">üî¥</span>${score}`; 
            GAME_OVER_OVERLAY.style.display = 'flex'; 
            updateModifierButtonState(); 
            removeInputListeners(); 
        }

        function showSplashScreen() {
            SPLASH_SCREEN.style.opacity = 1;
            SPLASH_SCREEN.style.display = 'flex'; 

            setTimeout(() => {
                SPLASH_SCREEN.style.opacity = 0; 
                setTimeout(() => {
                    SPLASH_SCREEN.style.display = 'none';
                    resetGame(); 
                }, 500); 
            }, 1000); 
        }

        function updateModeDisplay() {
            const mode = GAME_MODES[activeModeIndex];
            const text = mode.index === 0 ? `${mode.name} (Padr√£o)` : mode.name;
            CURRENT_MODE_DISPLAY.textContent = text;
            
            GAME_TITLE_ELEMENT.textContent = mode.name; 
            
            const isSnakeHell = mode.name === "Snake Hell";
            if (isSnakeHell) {
                SPEED_BLOCK.classList.add('disabled');
                GAME_BOARD.classList.add('snake-hell-border'); 
            } else {
                SPEED_BLOCK.classList.remove('disabled');
                GAME_BOARD.classList.remove('snake-hell-border'); 
            }
            PREV_MODE_BUTTON.disabled = activeModeIndex === 0;
            NEXT_MODE_BUTTON.disabled = activeModeIndex === GAME_MODES.length - 1;
        }

        function applySelectedMode() {
            updateModeDisplay();
            resetGame(); 
        }

        function goToPrevMode() { if (activeModeIndex > 0) { activeModeIndex--; applySelectedMode(); } }
        function goToNextMode() { if (activeModeIndex < GAME_MODES.length - 1) { activeModeIndex++; applySelectedMode(); } }

        function updateSpeedDisplay() {
            const multiplier = SPEED_MULTIPLIERS[activeMultiplierIndex];
            let text = multiplier === 1 ? '1x (Padr√£o)' : (multiplier === 0.5 ? '0.50x (Lento)' : `${multiplier}x`);
            CURRENT_SPEED_DISPLAY.textContent = text;
            PREV_SPEED_BUTTON.disabled = activeMultiplierIndex === 0;
            NEXT_SPEED_BUTTON.disabled = activeMultiplierIndex === SPEED_MULTIPLIERS.length - 1;
        }

        function applySelectedSpeed() {
            if (GAME_MODES[activeModeIndex].name !== "Snake Hell") {
                const multiplier = SPEED_MULTIPLIERS[activeMultiplierIndex];
                currentIntervalMS = BASE_INTERVAL_MS / multiplier; 
            }
            updateSpeedDisplay(); 
        }

        function goToPrevSpeed() { if (activeMultiplierIndex > 0) { activeMultiplierIndex--; applySelectedSpeed(); } }
        function goToNextSpeed() { if (activeMultiplierIndex < SPEED_MULTIPLIERS.length - 1) { activeMultiplierIndex++; applySelectedSpeed(); } }
        
        function updateSizeDisplay() {
            const size = GRID_SIZES[activeSizeIndex];
            const text = size === 20 ? `${size}x${size} (Padr√£o)` : `${size}x${size}`;
            CURRENT_SIZE_DISPLAY.textContent = text;
            PREV_SIZE_BUTTON.disabled = activeSizeIndex === 0;
            NEXT_SIZE_BUTTON.disabled = activeSizeIndex === GRID_SIZES.length - 1;
        }

        function applySelectedSize() {
            gridSize = GRID_SIZES[activeSizeIndex];
            updateSizeDisplay();
            resetGame(); 
        }

        function goToPrevSize() { if (activeSizeIndex > 0) { activeSizeIndex--; applySelectedSize(); } }
        function goToNextSize() { if (activeSizeIndex < GRID_SIZES.length - 1) { activeSizeIndex++; applySelectedSize(); } }
        
        function updateColorDisplay() {
            const color = SNAKE_COLORS[activeColorIndex];
            CURRENT_COLOR_DISPLAY.textContent = color.emoji;
            PREV_COLOR_BUTTON.disabled = activeColorIndex === 0;
            NEXT_COLOR_BUTTON.disabled = activeColorIndex === SNAKE_COLORS.length - 1;
            drawGame();
        }
        
        function goToPrevColor() { if (activeColorIndex > 0) { activeColorIndex--; updateColorDisplay(); } }
        function goToNextColor() { if (activeColorIndex < SNAKE_COLORS.length - 1) { activeColorIndex++; updateColorDisplay(); } }
        
        // FUN√á√ïES DE CONTROLE DE OLHOS - REINSERIDO
        function updateEyeDisplay() {
            const eye = SNAKE_EYES[activeEyeIndex];
            CURRENT_EYE_DISPLAY.textContent = eye.emoji === '' ? '[Sem Rosto]' : eye.emoji;
            CURRENT_EYE_DISPLAY.style.fontSize = eye.emoji === '' ? '1.2em' : '2.5em';

            PREV_EYE_BUTTON.disabled = activeEyeIndex === 0;
            NEXT_EYE_BUTTON.disabled = activeEyeIndex === SNAKE_EYES.length - 1;
            drawGame();
        }
        
        function goToPrevEye() { if (activeEyeIndex > 0) { activeEyeIndex--; updateEyeDisplay(); } }
        function goToNextEye() { if (activeEyeIndex < SNAKE_EYES.length - 1) { activeEyeIndex++; updateEyeDisplay(); } }
        // FIM FUN√á√ïES DE OLHOS

        function updateModifierButtonState() {
            MODIFIER_BUTTON.disabled = gameLoopInterval !== null; 
            HANGER_BUTTON.disabled = gameLoopInterval !== null; // REINSERIDO
        }
        
        function removeInputListeners() {
            GAME_BOARD.removeEventListener('touchstart', handleTouchStart, false);
            GAME_BOARD.removeEventListener('touchmove', handleTouchMove, false);
            GAME_BOARD.removeEventListener('touchend', handleTouchEnd, false);
        }

        function addInputListeners() {
            GAME_BOARD.addEventListener('touchstart', handleTouchStart, false);
            GAME_BOARD.addEventListener('touchmove', handleTouchMove, false);
            GAME_BOARD.addEventListener('touchend', handleTouchEnd, false);
        }
        
        function setupGame() {
            removeInputListeners(); 
            addInputListeners();
            
            const boardSize = Math.min(window.innerWidth - 40, window.innerHeight - 200, 600); 
            GAME_BOARD.style.width = `${boardSize}px`;
            GAME_BOARD.style.height = `${boardSize}px`;
            
            const currentCellSize = boardSize / gridSize; 
            GAME_BOARD.style.gridTemplateColumns = `repeat(${gridSize}, ${currentCellSize}px)`;
            GAME_BOARD.style.gridTemplateRows = `repeat(${gridSize}, ${currentCellSize}px)`;
            
            placeFood();
            
            loadHighScore(); 
            
            updateModeDisplay(); 
            updateSizeDisplay(); 
            updateSpeedDisplay(); 
            updateColorDisplay(); 
            updateEyeDisplay(); // REINSERIDO
            updateModifierButtonState(); 
            drawGame(); 
        }

        function resetGame() {
            if (gameLoopInterval) {
                clearInterval(gameLoopInterval);
                gameLoopInterval = null;
            }

            GAME_OVER_OVERLAY.style.display = 'none';
            RECORD_BREAK_MESSAGE_GAME_OVER.style.display = 'none'; 
            isGameOver = false;
            score = 0;
            isNewRecord = false;
            
            SCORE_BOARD_ELEMENT.classList.remove('new-record'); 
            NEW_RECORD_MESSAGE_ELEMENT.style.display = 'none';
            
            const center = Math.floor(gridSize / 2) + 1;
            
            if (GAME_MODES[activeModeIndex].name === "Snake Hell") {
                currentIntervalMS = 120; 
                snake = [
                    { x: center, y: center },
                    { x: center - 1, y: center },
                    { x: center - 2, y: center } 
                ];
            } else {
                applySelectedSpeed(); 
                snake = [{ x: center, y: center }]; 
            }

            direction = { x: 0, y: 0 };
            newDirection = { x: 0, y: 0 };
            lastValidDirection = { x: 0, y: -1 };
            MESSAGE_BOX.textContent = `Arraste a tela para come√ßar!`;

            setupGame(); 
        }

        function initializeGlobalListeners() {
            PREV_MODE_BUTTON.addEventListener('click', () => { playClickSound(); goToPrevMode(); });
            NEXT_MODE_BUTTON.addEventListener('click', () => { playClickSound(); goToNextMode(); });
            PREV_SPEED_BUTTON.addEventListener('click', () => { playClickSound(); goToPrevSpeed(); });
            NEXT_SPEED_BUTTON.addEventListener('click', () => { playClickSound(); goToNextSpeed(); });
            PREV_SIZE_BUTTON.addEventListener('click', () => { playClickSound(); goToPrevSize(); }); 
            NEXT_SIZE_BUTTON.addEventListener('click', () => { playClickSound(); goToNextSize(); }); 
            
            PREV_COLOR_BUTTON.addEventListener('click', () => { playClickSound(); goToPrevColor(); });
            NEXT_COLOR_BUTTON.addEventListener('click', () => { playClickSound(); goToNextColor(); });
            
            // Listeners de Olhos - REINSERIDO
            PREV_EYE_BUTTON.addEventListener('click', () => { playClickSound(); goToPrevEye(); });
            NEXT_EYE_BUTTON.addEventListener('click', () => { playClickSound(); goToNextEye(); });
            
            VOLUME_BUTTON_MODAL.addEventListener('click', () => { playClickSound(); toggleVolume(); });
            
            CREDITS_BUTTON_MODAL.addEventListener('click', () => { 
                playClickSound(); 
                SETTINGS_OVERLAY.style.display = 'none'; 
                CREDITS_OVERLAY.style.display = 'flex';
            });
            CLOSE_CREDITS_MODAL.addEventListener('click', () => { 
                playClickSound(); 
                CREDITS_OVERLAY.style.display = 'none'; 
                SETTINGS_OVERLAY.style.display = 'flex'; 
            });

            // Listeners da Licen√ßa
            LICENSE_BUTTON_MODAL.addEventListener('click', () => { 
                playClickSound(); 
                LICENSE_TEXT_ELEMENT.textContent = LICENSE_TEXT_CONTENT; 
                SETTINGS_OVERLAY.style.display = 'none'; 
                LICENSE_OVERLAY.style.display = 'flex';
            });
            
            CLOSE_LICENSE_MODAL.addEventListener('click', () => { 
                playClickSound(); 
                LICENSE_OVERLAY.style.display = 'none'; 
                SETTINGS_OVERLAY.style.display = 'flex'; 
            });

            SETTINGS_BUTTON.addEventListener('click', () => { 
                playClickSound(); 
                SETTINGS_OVERLAY.style.display = 'flex';
            });
            
            // Listeners do Bot√£o de Roupa (Hanger) - REINSERIDO
            HANGER_BUTTON.addEventListener('click', () => { 
                if (HANGER_BUTTON.disabled) return; 
                playClickSound(); 
                HANGER_OVERLAY.style.display = 'flex';
            });

            HANGER_OVERLAY.addEventListener('click', (e) => {
                if (e.target.classList.contains('overlay')) {
                    playClickSound(); 
                    HANGER_OVERLAY.style.display = 'none';
                }
            });
            CLOSE_HANGER_MODAL.addEventListener('click', () => {
                playClickSound(); 
                HANGER_OVERLAY.style.display = 'none';
            });
            // FIM dos Listeners do Hanger


            MODIFIER_BUTTON.addEventListener('click', () => { 
                if (MODIFIER_BUTTON.disabled) return; 
                playClickSound(); 
                MODIFIER_OVERLAY.style.display = 'flex';
            });

            SETTINGS_OVERLAY.addEventListener('click', (e) => {
                if (e.target.classList.contains('overlay')) {
                    playClickSound(); 
                    SETTINGS_OVERLAY.style.display = 'none';
                }
            });
            CLOSE_SETTINGS_MODAL.addEventListener('click', () => {
                playClickSound(); 
                SETTINGS_OVERLAY.style.display = 'none';
            });

            MODIFIER_OVERLAY.addEventListener('click', (e) => {
                if (e.target.classList.contains('overlay')) {
                    playClickSound(); 
                    MODIFIER_OVERLAY.style.display = 'none';
                }
            });
            CLOSE_MODIFIER_MODAL.addEventListener('click', () => {
                playClickSound(); 
                MODIFIER_OVERLAY.style.display = 'none';
            });
            
            window.addEventListener('resize', resetGame); 
            
            // Listener de rein√≠cio APENAS no bot√£o "Ir Denovo" - RESTAURADO
            RESTART_BUTTON.addEventListener('click', () => {
                playClickSound();
                resetGame();
            });
            
            // Impedir que o clique na tela Game Over reinicie o jogo (a menos que seja o bot√£o)
            GAME_OVER_MODAL.addEventListener('click', (e) => {
                e.stopPropagation(); 
            });
        }
        
        function init() {
            initializeGlobalListeners();
            showSplashScreen(); 
        }
        
        window.onload = init;
    </script>
</body>
</html>
